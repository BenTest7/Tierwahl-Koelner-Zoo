<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kölner Zoo – Tiere per Klick (2 Karten, minimal)</title>
<style>
  html,body{height:100%;margin:0;background:#0b1220;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  .stage{height:100%;display:flex;align-items:center;justify-content:center;padding:10px;}
  .frame{
    position:relative;
    width:min(1500px, 100%);
    aspect-ratio:16/9;
    background:#0f172a;
    border:1px solid rgba(255,255,255,.14);
    border-radius:16px;
    overflow:hidden;
  }
  .controls{
    position:absolute; top:12px; right:12px;
    display:flex; gap:8px;
    z-index:5;
  }
  .controls button{
    border:1px solid rgba(255,255,255,.14);
    background:rgba(10,16,28,.55);
    color:#e8edf7;
    padding:8px 10px;
    border-radius:999px;
    cursor:pointer;
    font-weight:650;
    font-size:12.5px;
    backdrop-filter: blur(6px);
  }
  .controls button:hover{background:rgba(10,16,28,.72);}
  svg{position:absolute; inset:0; width:100%; height:100%;}
  .hotspot{fill:rgba(0,0,0,0); stroke:none; cursor:pointer; pointer-events:all;}
  body.show-hotspots .hotspot{stroke:rgba(255,255,255,.35); stroke-width:.4; fill:rgba(255,255,255,.04);}
</style>
</head>
<body>
<div class="stage">
  <div class="frame">
    <div class="controls">
      <button id="btnAll">Alle anzeigen</button>
      <button id="btnNone">Alle löschen</button>
    </div>

    <svg id="svg" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="Zoo-Karte interaktiv">
      <image href="zoo_blank_hd.jpg" x="0" y="0" width="100" height="100" preserveAspectRatio="none"></image>
      <defs id="defs"></defs>
      <g id="reveals"></g>
      <g id="hotspots"></g>
    </svg>
  </div>
</div>

<script>
const STORAGE_KEY = "koelner_zoo_minimal_v3";
const animalsImageHref = "zoo_animals_hd.jpg";
const defaultHotspots = [{"id": "elefant", "name": "Elefanten", "x": 43, "y": 33, "r": 6.5}, {"id": "paviane", "name": "Paviane", "x": 78, "y": 14, "r": 5.8}, {"id": "tiger", "name": "Tiger", "x": 89, "y": 29, "r": 6.0}, {"id": "flamingos", "name": "Flamingos", "x": 79, "y": 74, "r": 6.0}, {"id": "pinguine", "name": "Pinguine", "x": 52, "y": 67, "r": 6.0}, {"id": "seeloewen", "name": "Seelöwen", "x": 26, "y": 63, "r": 6.0}, {"id": "hippodom", "name": "Flusspferde", "x": 76, "y": 80, "r": 6.8}];

function clampNum(v,a,b){ v=Number(v); if(Number.isNaN(v)) v=a; return Math.max(a, Math.min(b,v)); }

let state = loadState();
const svg = document.getElementById("svg");
const defs = document.getElementById("defs");
const reveals = document.getElementById("reveals");
const hotspotsLayer = document.getElementById("hotspots");

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return { hotspots: defaultHotspots.map(h=>({...h, visible:false})) };
    const parsed = JSON.parse(raw);
    return {
      hotspots: parsed.hotspots.map(h => ({
        id: h.id || String(Date.now()),
        name: h.name || "Tier",
        x: clampNum(h.x,0,100),
        y: clampNum(h.y,0,100),
        r: clampNum(h.r ?? 6.0, 2, 14),
        visible: !!h.visible
      }))
    };
  }catch(e){
    return { hotspots: defaultHotspots.map(h=>({...h, visible:false})) };
  }
}

function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){} }

function makeSvgEl(tag, attrs){
  const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
  for(const [k,v] of Object.entries(attrs||{})) el.setAttribute(k, String(v));
  return el;
}

function render(){
  defs.innerHTML = "";
  reveals.innerHTML = "";
  hotspotsLayer.innerHTML = "";

  state.hotspots.forEach(h => {
    const clipId = "clip_" + h.id;

    const clip = makeSvgEl("clipPath", { id: clipId });
    clip.appendChild(makeSvgEl("circle", { cx:h.x, cy:h.y, r:h.r }));
    defs.appendChild(clip);

    if (h.visible){
      const g = makeSvgEl("g", {});
      g.setAttribute("clip-path", `url(#${clipId})`);
      g.appendChild(makeSvgEl("image", {
        href: animalsImageHref, x:0, y:0, width:100, height:100, preserveAspectRatio:"none"
      }));
      reveals.appendChild(g);
    }

    const hs = makeSvgEl("circle", { cx:h.x, cy:h.y, r:h.r, class:"hotspot" });
    const title = makeSvgEl("title", {});
    title.textContent = h.name;
    hs.appendChild(title);

    hs.addEventListener("click", (e)=>{
      e.preventDefault();
      h.visible = !h.visible;
      saveState();
      render();
    });
    hotspotsLayer.appendChild(hs);
  });
}

function setAll(on){
  state.hotspots.forEach(h => h.visible = !!on);
  saveState();
  render();
}

document.getElementById("btnAll").addEventListener("click", ()=> setAll(true));
document.getElementById("btnNone").addEventListener("click", ()=> setAll(false));

window.addEventListener("keydown", (e)=>{ if(e.key==="Shift") document.body.classList.add("show-hotspots"); });
window.addEventListener("keyup", (e)=>{ if(e.key==="Shift") document.body.classList.remove("show-hotspots"); });

render();
</script>
</body>
</html>
