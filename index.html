<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KÃ¶lner Zoo â€“ Presenter + Publikum</title>
<style>
  :root{
    --bg:#0b1220;
    --panel:rgba(10,16,28,.62);
    --panel2:rgba(10,16,28,.78);
    --text:#e8edf7;
    --muted:rgba(232,237,247,.75);
    --border:rgba(255,255,255,.14);
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  .stage{height:100%;display:flex;align-items:center;justify-content:center;padding:10px;}
  .frame{
    position:relative;
    width:min(1700px, 100%);
    height:100%;
    background:#0f172a;
    border:1px solid var(--border);
    border-radius:16px;
    overflow:hidden;
  }
  svg{position:absolute; inset:0; width:100%; height:100%;}

  /* Presenter controls */
  .hud{
    position:absolute; top:12px; right:12px;
    display:flex; gap:8px; flex-wrap:wrap;
    z-index:6;
  }
  .hud button{
    border:1px solid rgba(255,255,255,.14);
    background:var(--panel);
    color:var(--text);
    padding:8px 10px;
    border-radius:999px;
    cursor:pointer;
    font-weight:650;
    font-size:12.5px;
    backdrop-filter: blur(6px);
  }

  /* Presenter list */
  .panelList{
    position:absolute; left:12px; top:12px;
    width:min(300px, calc(100% - 24px));
    max-height:calc(100% - 24px);
    overflow:auto;
    background:var(--panel2);
    border:1px solid rgba(255,255,255,.14);
    border-radius:16px;
    padding:10px;
    z-index:6;
    backdrop-filter: blur(6px);
  }
  .item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:8px 10px;
    margin:6px 2px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    cursor:pointer;
  }
  .left{display:flex; align-items:center; gap:10px;}
  .name{font-weight:700; font-size:13px;}
  .pill{
    font-size:11.5px;
    font-weight:800;
    padding:5px 8px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.16);
  }
  .off{ background:rgba(239,68,68,.14); }
  .off .pill{ background:rgba(239,68,68,.22); color:#fecaca; }
  .on{ background:rgba(34,197,94,.14); }
  .on .pill{ background:rgba(34,197,94,.22); color:#bbf7d0; }

  /* Audience mode */
  body.audience .hud,
  body.audience .panelList{display:none;}
</style>
</head>
<body>
<div class="stage">
  <div class="frame">
    <div class="panelList" id="panelList">
      <div id="list"></div>
    </div>

    <div class="hud">
      <button id="btnOpen">Publikumsansicht Ã¶ffnen</button>
      <button id="btnAll">Alle anzeigen</button>
      <button id="btnNone">Alle lÃ¶schen</button>
    </div>

    <svg id="svg" viewBox="0 0 100 100" preserveAspectRatio="none">
      <image href="zoo_blank_aligned.jpg" x="0" y="0" width="100" height="100"></image>
      <defs id="defs"></defs>
      <g id="reveals"></g>
    </svg>
  </div>
</div>

<script>
const animalsImageHref = "zoo_animals_hd2.jpg";
const HOTSPOTS = [{"id": "elefant", "name": "Elefanten", "emoji": "ðŸ˜", "x": 43, "y": 33, "r": 6.5}, {"id": "paviane", "name": "Paviane", "emoji": "ðŸ’", "x": 78, "y": 14, "r": 5.8}, {"id": "tiger", "name": "Tiger", "emoji": "ðŸ¯", "x": 89, "y": 29, "r": 6.0}, {"id": "flamingos", "name": "Flamingos", "emoji": "ðŸ¦©", "x": 79, "y": 74, "r": 6.0}, {"id": "pinguine", "name": "Pinguine", "emoji": "ðŸ§", "x": 52, "y": 67, "r": 6.0}, {"id": "seeloewen", "name": "SeelÃ¶wen", "emoji": "ðŸ¦­", "x": 26, "y": 63, "r": 6.0}, {"id": "hippodom", "name": "Flusspferde", "emoji": "ðŸ¦›", "x": 76, "y": 80, "r": 6.8}];
const STORAGE_KEY="zoo_sync_state_v3";
const CHANNEL="zoo-sync-v3";

const params=new URLSearchParams(location.search);
const isAudience=params.get("audience")==="1";
document.body.classList.toggle("audience",isAudience);

let state=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{"visible":{}}');
HOTSPOTS.forEach(h=>{if(state.visible[h.id]===undefined)state.visible[h.id]=false;});

const defs=document.getElementById("defs");
const reveals=document.getElementById("reveals");
const list=document.getElementById("list");

function svgEl(tag,a){const e=document.createElementNS("http://www.w3.org/2000/svg",tag);for(const k in a)e.setAttribute(k,a[k]);return e;}

function render(){
  defs.innerHTML="";reveals.innerHTML="";
  HOTSPOTS.forEach(h=>{
    const clip="c_"+h.id;
    const cp=svgEl("clipPath",{id:clip});
    cp.appendChild(svgEl("circle",{cx:h.x,cy:h.y,r:h.r}));
    defs.appendChild(cp);
    if(state.visible[h.id]){
      const g=svgEl("g",{"clip-path":"url(#"+clip+")"});
      g.appendChild(svgEl("image",{href:animalsImageHref,x:0,y:0,width:100,height:100}));
      reveals.appendChild(g);
    }
  });
  if(!isAudience)renderList();
}

function renderList(){
  list.innerHTML="";
  HOTSPOTS.forEach(h=>{
    const on=state.visible[h.id];
    const d=document.createElement("div");
    d.className="item "+(on?"on":"off");
    d.innerHTML=`
      <div class="left">
        <div style="font-size:18px">${h.emoji}</div>
        <div class="name">${h.name}</div>
      </div>
      <div class="pill">${on?"AN":"AUS"}</div>`;
    d.onclick=()=>toggle(h.id);
    list.appendChild(d);
  });
}

function toggle(id){
  state.visible[id]=!state.visible[id];
  sync();
}

function sync(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
  if(bc)bc.postMessage(state);
  render();
}

let bc=null;
try{bc=new BroadcastChannel(CHANNEL);bc.onmessage=e=>{state=e.data;render();};}catch{}
window.addEventListener("storage",e=>{if(e.key===STORAGE_KEY){state=JSON.parse(e.newValue);render();}});

document.getElementById("btnOpen").onclick=()=>{
  const u=new URL(location.href);u.searchParams.set("audience","1");
  window.open(u,"audience");
};
document.getElementById("btnAll").onclick=()=>{HOTSPOTS.forEach(h=>state.visible[h.id]=true);sync();};
document.getElementById("btnNone").onclick=()=>{HOTSPOTS.forEach(h=>state.visible[h.id]=false);sync();};

render();
</script>
</body>
</html>
