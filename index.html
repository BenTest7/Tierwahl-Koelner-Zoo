<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>K√∂lner Zoo ‚Äì Pr√§sentationsmodus</title>
<style>
  :root{
    --bg:#0b1220;
    --panel:rgba(10,16,28,.55);
    --text:#e8edf7;
    --border:rgba(255,255,255,.14);
    --red:#ef4444;
    --green:#22c55e;
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  .stage{height:100%;display:flex;align-items:center;justify-content:center;padding:10px;}
  .frame{
    position:relative;
    width:min(1800px, 100%);
    height:100%;
    background:#0f172a;
    border:1px solid var(--border);
    border-radius:16px;
    overflow:hidden;
  }
  svg{position:absolute; inset:0; width:100%; height:100%;}

  .hud{
    position:absolute; top:12px; right:12px;
    display:flex; gap:8px;
    z-index:6;
  }
  .hud button{
    border:1px solid rgba(255,255,255,.14);
    background:var(--panel);
    color:var(--text);
    padding:8px 10px;
    border-radius:999px;
    cursor:pointer;
    font-weight:650;
    font-size:12.5px;
  }

  .hs{
    fill: rgba(0,0,0,0);
    stroke-width: 0.8;
    cursor: pointer;
  }
  .hs.off{ stroke: var(--red); }
  .hs.on{ stroke: var(--green); }

  /* Hide hotspots and controls in audience mode */
  body.audience .hs{display:none;}
  body.audience .hud{display:none;}
</style>
</head>
<body>
<div class="stage">
  <div class="frame">
    <div class="hud">
      <button id="btnOpen">Publikumsansicht √∂ffnen</button>
      <button id="btnAll">Alle anzeigen</button>
      <button id="btnNone">Alle l√∂schen</button>
    </div>

    <svg id="svg" viewBox="0 0 100 100" preserveAspectRatio="none">
      <!-- blank base -->
      <image href="zoo_blank_aligned.jpg" x="0" y="0" width="100" height="100"></image>

      <!-- mask to hide giraffe/leopard label lines -->
      <rect x="70" y="0" width="30" height="25" fill="rgba(255,255,255,0.98)"></rect>

      <defs id="defs"></defs>
      <g id="reveals"></g>
      <g id="hotspots"></g>
    </svg>
  </div>
</div>

<script>
const animalsImageHref="zoo_animals_hd2.jpg";
const HOTSPOTS=[{"id": "elefant", "name": "Elefanten", "emoji": "üêò", "x": 43, "y": 33, "r": 5.8}, {"id": "paviane", "name": "Paviane", "emoji": "üêí", "x": 76, "y": 14, "r": 5.0}, {"id": "tiger", "name": "Tiger", "emoji": "üêØ", "x": 88, "y": 29, "r": 5.0}, {"id": "flamingos", "name": "Flamingos", "emoji": "ü¶©", "x": 79, "y": 74, "r": 5.0}, {"id": "pinguine", "name": "Pinguine", "emoji": "üêß", "x": 52, "y": 67, "r": 5.0}, {"id": "seeloewen", "name": "Seel√∂wen", "emoji": "ü¶≠", "x": 26, "y": 63, "r": 5.0}, {"id": "hippodom", "name": "Flusspferde", "emoji": "ü¶õ", "x": 76, "y": 80, "r": 5.8}];
const STATE_KEY="zoo_state_simple_v1";
const CHANNEL="zoo-sync-simple-v1";

const params=new URLSearchParams(location.search);
const isAudience=params.get("audience")==="1";
document.body.classList.toggle("audience",isAudience);

let visible=JSON.parse(localStorage.getItem(STATE_KEY)||"{}");
HOTSPOTS.forEach(h=>{if(visible[h.id]===undefined)visible[h.id]=false;});

const svg=document.getElementById("svg");
const defs=document.getElementById("defs");
const reveals=document.getElementById("reveals");
const hsLayer=document.getElementById("hotspots");

function el(tag,a){const e=document.createElementNS("http://www.w3.org/2000/svg",tag);for(const k in a)e.setAttribute(k,a[k]);return e;}

function render(){
 defs.innerHTML="";reveals.innerHTML="";hsLayer.innerHTML="";
 HOTSPOTS.forEach(h=>{
   const on=visible[h.id];
   const clip="c_"+h.id;
   const cp=el("clipPath",{id:clip});
   cp.appendChild(el("circle",{cx:h.x,cy:h.y,r:h.r}));
   defs.appendChild(cp);

   if(on){
     const g=el("g",{"clip-path":"url(#"+clip+")"});
     g.appendChild(el("image",{href:animalsImageHref,x:0,y:0,width:100,height:100}));
     reveals.appendChild(g);
   }

   if(!isAudience){
     const c=el("circle",{cx:h.x,cy:h.y,r:h.r,class:"hs "+(on?"on":"off")});
     c.onclick=()=>toggle(h.id);
     hsLayer.appendChild(c);
   }
 });
}

function toggle(id){
 visible[id]=!visible[id];
 sync();
}

function sync(){
 localStorage.setItem(STATE_KEY,JSON.stringify(visible));
 if(bc)bc.postMessage(visible);
 render();
}

let bc=null;
try{bc=new BroadcastChannel(CHANNEL);bc.onmessage=e=>{visible=e.data;render();};}catch{}
window.addEventListener("storage",e=>{if(e.key===STATE_KEY){visible=JSON.parse(e.newValue);render();}});

document.getElementById("btnOpen").onclick=()=>{
 const u=new URL(location.href);u.searchParams.set("audience","1");
 window.open(u,"audience");
};
document.getElementById("btnAll").onclick=()=>{HOTSPOTS.forEach(h=>visible[h.id]=true);sync();};
document.getElementById("btnNone").onclick=()=>{HOTSPOTS.forEach(h=>visible[h.id]=false);sync();};

render();
</script>
</body>
</html>
